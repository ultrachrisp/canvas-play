(function(w,T){typeof exports=="object"&&typeof module<"u"?T(exports):typeof define=="function"&&define.amd?define(["exports"],T):(w=typeof globalThis<"u"?globalThis:w||self,T(w.SpinningSVGs={}))})(this,function(w){"use strict";function T(){let n=-1,o=-1,r=0;function i(g){n=(g-o)*.06,o=g,r=Number((r+.25).toFixed(1))}function e(){return{frame:r,speedFactor:n}}function a(g){r=g}function f(){return n}return{setTimestamp:i,getFrame:e,setFrame:a,getSpeedFactor:f}}function G({settings:t}){const{tag:n,colours:o,svgWidth:r}=t,i=document.querySelector(n);if(!i)throw new Error("Provided canvas tag does not exist in the HTML document");const e=i;e.replaceChildren();const{canvas:a,context:f}=W();e.appendChild(a),e.setAttribute("style","box-sizing: border-box; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;");const{canvas:g,context:h}=W();g.width=o.length*r,g.height=r,I({settings:t,spriteContext:h});function m(){return f}function v(){return a}function s(){return g}function l(){x({canvas:a,context:f});const{canvasWidth:c,canvasHeight:p}=z(e,r);return a.width=c,a.height=p,{canvasWidth:c,canvasHeight:p}}function u(){x({canvas:a,context:f})}return{resize:l,draw:u,getCanvas:v,getContext:m,getOffscreenCanvas:s}}function I({settings:t,spriteContext:n}){const{svg:o,svgQuery:r,colours:i,svgWidth:e}=t;let a=i.length;for(;a--;){const f=o.replace(r,i[a]),g=encodeURIComponent(f),h=new Image,m=a*e;h.onload=()=>{n.drawImage(h,m,0,e,e)},h.src=`data:image/svg+xml,${g}`}}function x({canvas:t,context:n}){return n.clearRect(0,0,t.width,t.height)}function W(){const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("Failed to get 2D canvas context");return{canvas:t,context:n}}function z(t,n){const{width:o,height:r}=t.getBoundingClientRect(),i=Math.floor(o/n)*n,e=Math.floor(r/n)*n;return{canvasWidth:i,canvasHeight:e}}function R({width:t,height:n,arrayPositionX:o,arrayPositionY:r,numOfColours:i}){let e=1,a=e/2,f=0,g=0;const h=Math.PI/180,m=o*t+t/2,v=r*n+n/2;let s=0,l=!1,u=!0,c="fadeIn",p=0,C=0;const S=o+r;function P(d){S<d&&(e*=1.05,a=e/2,e>=t&&(e=t,u=!1,c="spin"))}function y(){u?(e*=1.05,s=L(),e>=t&&(e=t,u=!1,c="spin")):(e*=.95,e<15&&(u=!0,l=!0)),a=e/2}function M(d){p===0&&(p=d),C+p<=d&&(u?(e*=1.05,s=0,e>=t&&(e=t,u=!1,c="spin",p=0)):(e*=.95,e<15&&(u=!0,l=!0)),a=e/2)}function L(){return l?(l=!1,s>=i-1?0:++s):s}function O({frame:d,speedFactor:b}){switch(f=f>360?0:f+b,g=f*h,c){case"fadeIn":P(d);break;case"hover":y();break;case"wave":M(d);break;case"spin":default:c="spin"}}function j({context:d,spriteSheet:b}){d.save(),d.translate(m,v),d.rotate(g),d.drawImage(b,s*t,0,t,n,-a,-a,e,e),d.restore()}function q(d){c=d}function V(){return c}function B(){return{arrayPositionX:o,arrayPositionY:r}}function N(d,b){C=d,c=b}return{hover:y,update:O,draw:j,setParticleState:q,getParticleState:V,getArrayPosition:B,setDistanceToTarget:N}}function E({cellWidth:t,numOfSprites:n,canvasWidth:o,canvasHeight:r}){let{gridRows:i,gridColumns:e}=H({canvasWidth:o,canvasHeight:r,cellWidth:t}),a=F({gridRows:i,gridColumns:e,cellWidth:t,numOfSprites:n});function f(){return a}function g({canvasWidth:s,canvasHeight:l}){({gridRows:i,gridColumns:e}=H({canvasWidth:s,canvasHeight:l,cellWidth:t})),a=F({gridRows:i,gridColumns:e,cellWidth:t,numOfSprites:n})}function h({targetRow:s,targetColumn:l}){const u=a[s][l];u.setParticleState("click");const{arrayPositionX:c,arrayPositionY:p}=u.getArrayPosition();for(let C=0;C<i;C++)for(let S=0;S<e;S++){const{arrayPositionX:P,arrayPositionY:y}=a[C][S].getArrayPosition(),M=Math.abs(c-P)+Math.abs(p-y);a[C][S].setDistanceToTarget(M,"wave")}}function m({frame:s,speedFactor:l}){for(let u=0;u<i;u++)for(let c=0;c<e;c++)a[u][c].update({frame:s,speedFactor:l})}function v({context:s,spriteSheet:l}){for(let u=0;u<i;u++)for(let c=0;c<e;c++)a[u][c].draw({context:s,spriteSheet:l})}return{getGrid:f,resize:g,update:m,draw:v,prepareWave:h}}function F({gridRows:t,gridColumns:n,cellWidth:o,numOfSprites:r}){const i=new Array(t);for(let e=0;e<t;e++){i[e]=new Array(n);for(let a=0;a<n;a++){const f=R({width:o,height:o,arrayPositionX:e,arrayPositionY:a,numOfColours:r});i[e][a]=f}}return i}function X({evt:t,canvas:n}){const{left:o,top:r}=n.getBoundingClientRect(),i=t.clientX-o,e=t.clientY-r;return{mouseX:i,mouseY:e}}function Y({mouseX:t,mouseY:n,cellWidth:o}){const r=Math.floor(t/o),i=Math.floor(n/o),e=r>0?r:0,a=i>0?i:0;return{row:e,column:a}}function H({canvasWidth:t,canvasHeight:n,cellWidth:o}){const r=Math.floor(t/o),i=Math.floor(n/o);return{gridRows:r,gridColumns:i}}function k(t){const n=T(),o=G({settings:t}),{canvasWidth:r,canvasHeight:i}=o.resize(),e=E({cellWidth:t.svgWidth,numOfSprites:t.colours.length,canvasWidth:r,canvasHeight:i});let a=globalThis.innerWidth;addEventListener("resize",D(()=>f(),300)),o.getCanvas().addEventListener("click",v=>{const{row:s,column:l}=A(v,o.getCanvas(),t.svgWidth);e.prepareWave({targetRow:s,targetColumn:l})}),o.getCanvas().addEventListener("mousemove",v=>{const{row:s,column:l}=A(v,o.getCanvas(),t.svgWidth);e.getGrid()[s][l].setParticleState("hover")});function f(){if(a!==globalThis.innerWidth){n.setFrame(0);const{canvasWidth:v,canvasHeight:s}=o.resize();e.resize({canvasWidth:v,canvasHeight:s}),a=globalThis.innerWidth}}function g(){e.update({...n.getFrame()})}function h(){o.draw(),e.draw({context:o.getContext(),spriteSheet:o.getOffscreenCanvas()})}function m(v){n.setTimestamp(v),g(),h(),requestAnimationFrame(m)}f(),m(performance.now())}function A(t,n,o){const{mouseX:r,mouseY:i}=X({evt:t,canvas:n});return Y({mouseX:r,mouseY:i,cellWidth:o})}function D(t,n){let o;return(...r)=>{clearTimeout(o),o=setTimeout(()=>t(...r),n)}}w.SpinningSVGs=k,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
